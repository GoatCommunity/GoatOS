#!/bin/bash
# GoatOS Report Generator

set -e

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

TEMPLATES_DIR="/opt/templates"
REPORTS_DIR="$HOME/Reports"

show_banner() {
    echo -e "${GREEN}"
    echo "   ____             _   ____                       _   "
    echo "  / ___| ___   __ _| |_|  _ \ ___ _ __   ___  _ __| |_ "
    echo " | |  _ / _ \ / _\` | __| |_) / _ \ '_ \ / _ \| '__| __|"
    echo " | |_| | (_) | (_| | |_|  _ <  __/ |_) | (_) | |  | |_ "
    echo "  \____|\___/ \__,_|\__|_| \_\___| .__/ \___/|_|   \__|"
    echo "                                 |_|                    "
    echo -e "${NC}"
    echo "GoatOS Pentest Report Generator"
    echo ""
}

show_help() {
    echo "Usage: goat-report [options]"
    echo ""
    echo "Options:"
    echo "  -p, --project    Project/Client name"
    echo "  -t, --target     Target URL or domain"
    echo "  -o, --output     Output filename"
    echo "  -f, --format     Output format: md, html (default: md)"
    echo "  -T, --template   Template: full, quick, vuln (default: full)"
    echo "  -h, --help       Show this help"
    echo ""
    echo "Examples:"
    echo "  goat-report                     # Interactive mode"
    echo "  goat-report -p 'Acme' -t 'acme.com' -o report.md"
}

create_report() {
    local project="$1"
    local target="$2"
    local output="$3"
    local template="$4"
    local date=$(date +"%Y-%m-%d")
    local tester=$(whoami)
    
    mkdir -p "$REPORTS_DIR"
    
    if [ -z "$output" ]; then
        output="$REPORTS_DIR/${project// /-}_${date}.md"
    fi
    
    echo -e "${YELLOW}[*] Generating report...${NC}"
    
    # Copy template and replace placeholders
    if [ "$template" == "quick" ]; then
        cat > "$output" << EOF
# Quick Report: $project

**Target:** $target
**Date:** $date
**Tester:** $tester

## Findings

| # | Severity | Vulnerability | URL |
|---|----------|---------------|-----|
| 1 |  |  |  |

## Notes

EOF
    else
        cat > "$output" << EOF
# Pentest Report: $project

## Executive Summary

**Client:** $project
**Target:** $target
**Date:** $date
**Tester:** $tester

### Overall Risk Rating

| Rating | Count |
|--------|-------|
| ðŸ”´ Critical | 0 |
| ðŸŸ  High | 0 |
| ðŸŸ¡ Medium | 0 |
| ðŸŸ¢ Low | 0 |

---

## Scope

### Targets

- $target

### Methodology

- OWASP Testing Guide
- GoatOS Web/API Pentesting Workflow

---

## Findings

### Finding 1: [Title]

| Attribute | Value |
|-----------|-------|
| **Severity** | |
| **URL** | |
| **CWE** | |

#### Description



#### Evidence

\`\`\`

\`\`\`

#### Remediation



---

## Appendix

### Tools Used

- Nuclei
- ffuf
- Burp Suite
- GoatOS toolkit

---

*Generated with GoatOS*
EOF
    fi
    
    echo -e "${GREEN}[âœ“] Report created: $output${NC}"
    echo ""
    echo "Next steps:"
    echo "  1. Edit the report: nano $output"
    echo "  2. Add your findings"
    echo "  3. Convert to PDF: pandoc $output -o ${output%.md}.pdf"
}

# Parse arguments
PROJECT=""
TARGET=""
OUTPUT=""
FORMAT="md"
TEMPLATE="full"

while [[ $# -gt 0 ]]; do
    case $1 in
        -p|--project) PROJECT="$2"; shift 2 ;;
        -t|--target) TARGET="$2"; shift 2 ;;
        -o|--output) OUTPUT="$2"; shift 2 ;;
        -f|--format) FORMAT="$2"; shift 2 ;;
        -T|--template) TEMPLATE="$2"; shift 2 ;;
        -h|--help) show_help; exit 0 ;;
        *) echo "Unknown option: $1"; show_help; exit 1 ;;
    esac
done

show_banner

# Interactive mode if no arguments
if [ -z "$PROJECT" ]; then
    read -p "Project/Client name: " PROJECT
fi

if [ -z "$TARGET" ]; then
    read -p "Target URL/domain: " TARGET
fi

if [ -z "$PROJECT" ] || [ -z "$TARGET" ]; then
    echo -e "${RED}[!] Project and target are required${NC}"
    exit 1
fi

create_report "$PROJECT" "$TARGET" "$OUTPUT" "$TEMPLATE"
